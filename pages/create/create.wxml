<!--pages/create/create.wxml - æµ·é¾Ÿæ±¤åˆ›å»ºé¡µé¢-->
<view class="page">
  <!-- å¯¼èˆªæ  -->
  <nav-bar title="åˆ›å»ºæµ·é¾Ÿæ±¤" showBack="{{true}}" bind:back="handleBack" />

  <view class="container">
    <view class="form-container">
      <!-- æ ‡é¢˜è¾“å…¥ -->
      <view class="form-item">
        <view class="form-label">æ ‡é¢˜</view>
        <input
          class="form-input {{validation.titleError ? 'input-error' : ''}}"
          placeholder="ç¤ºä¾‹ï¼šç¥ç§˜æ¥ç”µ | ä¸€ä¸ªç®€çŸ­ä¸å‰§é€çš„æ ‡é¢˜"
          maxlength="15"
          value="{{formData.title}}"
          bindinput="handleTitleInput"
        />
        <view class="error-text" wx:if="{{validation.titleError}}">{{validation.titleError}}</view>
        <view class="char-count">
          {{titleLength}}/15
        </view>
      </view>

      <!-- æ±¤é¢å†…å®¹è¾“å…¥ -->
      <view class="form-item">
        <view class="form-label">æ±¤é¢å†…å®¹</view>
        <textarea
          class="form-textarea {{validation.contentError ? 'input-error' : ''}}"
          placeholder="ç¤ºä¾‹ï¼šå¥¹æ¯å¤©åŒä¸€æ—¶é—´éƒ½ä¼šçš„æ— å£°ç”µè¯ğŸ’¡ è¯·æè¿°ä¸€ä¸ªå¼•äººå…¥èƒœçš„è°œé¢˜æƒ…å¢ƒï¼Œå¼•å‘è¯»è€…çš„å¥½å¥‡å¿ƒã€‚"
          maxlength="100"
          value="{{formData.content}}"
          bindinput="handleContentInput"
          auto-height
        />
        <view class="error-text" wx:if="{{validation.contentError}}">{{validation.contentError}}</view>
        <view class="char-count">
          {{contentLength}}/100
        </view>
      </view>

      <!-- æ±¤åº•å†…å®¹è¾“å…¥ -->
      <view class="form-item">
        <view class="form-label">æ±¤åº•å†…å®¹</view>
        <textarea
          class="form-textarea {{validation.truthError ? 'input-error' : ''}}"
          placeholder="è¯·è¾“å…¥æ±¤åº•å†…å®¹ï¼ˆè°œé¢˜ç­”æ¡ˆï¼Œ500å­—ä»¥å†…ï¼‰"
          maxlength="500"
          value="{{formData.truth}}"
          bindinput="handleTruthInput"
          auto-height
        />
        <view class="error-text" wx:if="{{validation.truthError}}">{{validation.truthError}}</view>
        <view class="char-count">
          {{truthLength}}/500
        </view>
      </view>

      <!-- æ ‡ç­¾é€‰æ‹© -->
      <view class="form-item">
        <view class="form-label">æ ‡ç­¾ <text class="tag-hint">(æœ€å¤šé€‰æ‹©3ä¸ª)</text></view>

        <!-- å·²é€‰æ ‡ç­¾æ˜¾ç¤ºåŒºåŸŸ -->
        <view class="selected-tags-container">
          <view wx:if="{{selectedTags.length === 0}}" class="no-tags-selected">
            è¯·ä»ä¸‹æ–¹é€‰æ‹©æ ‡ç­¾
          </view>
          <block wx:for="{{selectedTags}}" wx:key="*this">
            <view class="selected-tag">
              <text>{{item}}</text>
              <view class="tag-remove" bindtap="handleTagRemove" data-tag="{{item}}">Ã—</view>
            </view>
          </block>
        </view>

        <!-- æ ‡ç­¾æ±  - ä½¿ç”¨æ›´ç®€å•çš„å®ç° -->
        <view class="tag-pool">
          <block wx:for="{{tagPool}}" wx:key="*this">
            <view
              class="tag-button {{selectedTags.indexOf(item) !== -1 ? 'selected' : ''}}"
              bindtap="handleTagClick"
              data-tag="{{item}}"
            >{{item}}</view>
          </block>
        </view>
      </view>

      <!-- æäº¤æŒ‰é’® -->
      <view class="form-actions">
        <custom-button
          type="primary"
          text="{{isSubmitting ? 'æäº¤ä¸­...' : 'åˆ›å»ºæµ·é¾Ÿæ±¤'}}"
          width="100%"
          height="88rpx"
          loading="{{isSubmitting}}"
          disabled="{{isSubmitting}}"
          bind:tap="handleSubmit"
        />
      </view>
    </view>
  </view>

  <!-- ç™»å½•æç¤ºå¼¹çª— -->
  <popup
    id="loginPopup"
    title="ä¾¦æ¢å¤§äººï¼Œæƒ³åˆ›ä½œæµ·é¾Ÿæ±¤å—ï¼Ÿ"
    content="å…ˆå»ã€Œä¸ªäººä¸­å¿ƒã€ç™»å½•ä¸€ä¸‹å§ï½"
    confirmText="å»ç™»å½•â†’"
    cancelText="å†æƒ³æƒ³"
    showClose="{{false}}"
    showLoginIcon="{{true}}"
    bind:confirm="onLoginConfirm"
    bind:cancel="onLoginCancel"
  ></popup>
</view>