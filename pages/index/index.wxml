<!--pages/index.wxml - 海龟汤首页-->
<view class="page {{swiping ? 'swiping' : ''}}" style="{{gradientStyle ? '--dynamic-gradient: ' + gradientStyle : ''}}">
  <!-- 噪点效果 -->
  <view class="noise-overlay"></view>  <!-- 导航栏 -->
  <nav-bar
    isTabBarPage="{{true}}"
    bind:refreshPage="onRefreshHome"
  />

  <view class="container"
    bindtouchstart="handleTouchStart"
    bindtouchmove="handleTouchMove"
    bindtouchend="handleTouchEnd">

    <!-- 汤面显示区域 -->
    <view class="soup-display-wrapper">
      <soup-display
        id="soupDisplay"
        swipeDirection="{{swipeDirection}}"
        class="soup-display-component"
        bind:swipe="handleSoupSwipe"
      ></soup-display>
    </view>

    <!-- 按钮区域 -->
    <view class="button-container show-buttons">
      <!-- 开始喝汤按钮 - 根据 isLoggedIn 和数据状态自动控制 -->
      <button 
        class="start-button"
        disabled="{{!isLoggedIn || !chatPageUrl || buttonLoading}}"
        bind:tap="onStartChat"
      >
        {{buttonLoading ? '加载中...' : '开始喝汤'}}
      </button>
    </view>

    <!-- 恐怖元素 - 随机闪烁的微光点 -->
    <view class="horror-flicker"></view>
    <view class="horror-flicker"></view>
    <view class="horror-flicker"></view>
    <view class="horror-flicker"></view>
    <view class="horror-flicker"></view>
    <view class="horror-flicker"></view>
  </view>

  <!-- 新用户引导层组件 -->
  <guide-overlay
    show="{{showGuide}}"
    bind:close="onCloseGuide">
  </guide-overlay>

  <!-- 登录弹窗 - 自动根据 shouldShowLoginPopup 显示/隐藏 -->
  <login-popup 
      id="loginPopup" 
      wx:if="{{shouldShowLoginPopup}}"
      bind:confirm="onLoginConfirm"
      bind:cancel="onLoginCancel"
  />

</view>