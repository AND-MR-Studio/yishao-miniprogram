<!--pages/mine/mine.wxml-->
<view class="page">
  <!-- 导航栏 -->
  <nav-bar title="个人中心" />

  <view class="container">
    <!-- 用户名片 -->
    <detective-card
      id="detective-card"
      userInfo="{{userInfo}}"
      defaultAvatarUrl="{{defaultAvatarUrl}}"
      remainingAnswers="{{remainingAnswers}}"
      level="{{level}}"
      levelTitle="{{levelTitle}}"
      experience="{{experience}}"
      maxExperience="{{maxExperience}}"
      unsolvedCount="{{unsolvedCount}}"
      solvedCount="{{solvedCount}}"
      creationCount="{{creationCount}}"
      favoriteCount="{{favoriteCount}}"
      bind:signin="handleSignIn"
      bind:navigate="handleNavigate">
    </detective-card>

    <!-- 更新日志Banner轮播 -->
    <swiper class="banner-swiper" indicator-dots="{{true}}" autoplay="{{true}}" interval="{{3000}}" duration="{{500}}" circular="{{true}}">
      <swiper-item>
        <view class="update-banner">
          <view class="banner-content">
            <view class="banner-title">
              <text class="banner-title-main">一勺推理社更新日志</text>
              <text class="banner-title-sub">一勺侦探，前来干饭…不对，探案！</text>
            </view>
            <view class="banner-image"></view>
          </view>
        </view>
      </swiper-item>
      <swiper-item>
        <view class="update-banner banner-purple">
          <view class="banner-content">
            <view class="banner-title">
              <text class="banner-title-main">侦探社社员招募中</text>
              <text class="banner-title-sub">加入我们，解锁更多谜题</text>
            </view>
            <view class="banner-image"></view>
          </view>
        </view>
      </swiper-item>
      <swiper-item>
        <view class="update-banner banner-mix">
          <view class="banner-content">
            <view class="banner-title">
              <text class="banner-title-main">每日谜题挑战</text>
              <text class="banner-title-sub">提升推理能力，成为顶尖侦探</text>
            </view>
            <view class="banner-image"></view>
          </view>
        </view>
      </swiper-item>
    </swiper>

    <!-- 功能菜单 -->
    <view class="function-list">
      <!-- 帮助与反馈 -->
      <view class="function-item" bindtap="navigateToHelp">
        <view class="item-content">
          <text>帮助与反馈</text>
        </view>
        <view class="item-arrow"></view>
      </view>

      <!-- 关于一勺推理社 -->
      <view class="function-item" bindtap="navigateToAbout">
        <view class="item-content">
          <text>关于一勺推理社</text>
        </view>
        <view class="item-arrow"></view>
      </view>
    </view>

    <!-- 登录/退出按钮 -->
    <view class="logout-container">
      <view class="login-button-wrapper">
        <button-component
          type="{{userInfo ? 'unlight' : 'light'}}"
          text="{{userInfo ? '退出登录' : '微信一键登录'}}"
          width="500rpx"
          height="70rpx"
          bind:tap="{{userInfo ? 'handleLogout' : 'handleLogin'}}"
        />
      </view>
    </view>
  </view>

  <!-- 用户信息设置弹窗 - 只在showUserInfoModal为true时显示 -->
  <view class="user-info-modal {{showUserInfoModal ? 'show' : ''}}" catchtouchmove="catchTouchMove" wx:if="{{showUserInfoModal}}">
    <view class="user-info-container">
      <view class="user-info-header">
        <text class="user-info-title">设置侦探信息</text>
        <view class="user-info-close" bindtap="closeUserInfoModal">×</view>
      </view>

      <view class="user-info-body">
        <!-- 头像选择 - 居中显示 -->
        <view class="avatar-container-centered">
          <button class="avatar-btn-centered" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
            <image class="avatar-preview-centered" src="{{userInfo.avatarUrl || defaultAvatarUrl}}" mode="aspectFill"></image>
          </button>
        </view>

        <!-- 昵称输入 - 居中显示 -->
        <view class="nickname-container">
          <input
            type="nickname"
            class="nickname-input-centered"
            placeholder="{{userInfo.nickName ? '' : '请输入侦探代号'}}"
            value="{{userInfo.nickName}}"
            bindinput="onInputNickname"
            bindnicknamereview="onInputNickname"
          />
        </view>
      </view>

      <view class="user-info-footer">
        <button-component
          type="light"
          text="确认信息"
          width="100%"
          height="88rpx"
          bind:tap="confirmUserInfo"
        />
        <view class="skip-btn" bindtap="skipUserInfo">暂不设置</view>
      </view>
    </view>
  </view>
</view>