<!--pages/mine/mine.wxml-->
<view class="page">
  <!-- 导航栏 -->
  <nav-bar title="个人中心" />

  <view class="container">
    <!-- 用户信息卡片 -->
    <view class="user-card">
      <view class="avatar-container">
        <image class="avatar" src="{{userInfo.avatarUrl || defaultAvatarUrl}}" mode="aspectFill"></image>
      </view>
      <view class="user-info">
        <text class="username">{{userInfo.nickName || '未登录的侦探'}}</text>
        <view class="answer-count">
          <text class="count-label">剩余回答次数：</text>
          <text class="count-value">{{remainingAnswers || 0}}次</text>
        </view>
      </view>
    </view>

    <!-- 功能列表 -->
    <view class="function-list">
      <view class="function-item">
        <view class="item-icon">
          <text class="icon-about"></text>
        </view>
        <view class="item-content">
          <text>关于我们</text>
        </view>
        <view class="item-arrow">
          <text class="icon-right"></text>
        </view>
      </view>
    </view>

    <!-- 登录/退出按钮 -->
    <view class="logout-container">
      <button-component
        type="{{userInfo ? 'unlight' : 'light'}}"
        text="{{userInfo ? '退出登录' : '微信一键登录'}}"
        width="100%"
        height="88rpx"
        bind:tap="{{userInfo ? 'handleLogout' : 'handleLogin'}}"
      />
    </view>
  </view>



  <!-- 用户信息设置弹窗 - 只在showUserInfoModal为true时显示 -->
  <view class="user-info-modal {{showUserInfoModal ? 'show' : ''}}" catchtouchmove="catchTouchMove" wx:if="{{showUserInfoModal}}">
    <view class="user-info-container">
      <view class="user-info-header">
        <text class="user-info-title">设置侦探信息</text>
        <view class="user-info-close" bindtap="closeUserInfoModal">×</view>
      </view>

      <view class="user-info-body">
        <!-- 头像选择 - 居中显示 -->
        <view class="avatar-container-centered">
          <button class="avatar-btn-centered" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
            <image class="avatar-preview-centered" src="{{userInfo.avatarUrl || defaultAvatarUrl}}" mode="aspectFill"></image>
          </button>
        </view>

        <!-- 昵称输入 - 居中显示 -->
        <view class="nickname-container">
          <input
            type="nickname"
            class="nickname-input-centered"
            placeholder="{{userInfo.nickName ? '' : '请输入侦探代号'}}"
            value="{{userInfo.nickName}}"
            bindinput="onInputNickname"
            bindnicknamereview="onInputNickname"
          />
        </view>
      </view>

      <view class="user-info-footer">
        <button-component
          type="light"
          text="确认信息"
          width="100%"
          height="88rpx"
          bind:tap="confirmUserInfo"
        />
        <view class="skip-btn" bindtap="skipUserInfo">暂不设置</view>
      </view>
    </view>
  </view>
</view>