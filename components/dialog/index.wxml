<!--components/dialog/index.wxml-->
<view class="dialog-container {{isPeeking ? 'peek-mode' : ''}}">
  <!-- 导航栏 -->
  <view class="nav-bar-container" catchtap="handleClose">
    <nav-bar showBackButton="{{true}}" bind:back="handleClose" />
  </view>

  <!-- 毛玻璃效果背景 -->
  <view class="frosted-glass"></view>

  <!-- 对话区域 -->
  <scroll-view
    class="dialog-content"
    scroll-y="true"
    scroll-with-animation="true"
    scroll-anchoring="true"
    enhanced="true"
    bounces="true"
    show-scrollbar="false"
    enable-passive="true"
    id="dialogScroll"
    scroll-into-view="{{scrollToView}}"
  >
    <!-- 用户消息列表 -->
    <block wx:for="{{userMessages}}" wx:key="index" wx:for-item="message" wx:for-index="idx">
      <view class="message-wrapper user-message" id="user-msg-{{idx}}">
        <view class="message-content">
          <view class="message-text">{{message.content}}</view>
        </view>
      </view>
    </block>

    <!-- AI消息列表 -->
    <block wx:for="{{agentMessages}}" wx:key="index" wx:for-item="message" wx:for-index="idx">
      <view class="message-wrapper agent-message" id="agent-msg-{{idx}}">
        <view class="message-content">
          <view class="message-text {{chatState === 'loading' && idx === agentMessages.length - 1 ? 'typing' : ''}}">
            <!-- 根据状态显示内容 -->
            <text wx:if="{{chatState === 'loading' && idx === agentMessages.length - 1}}">{{typingText}}</text>
            <text wx:else>{{message.content}}</text>
          </view>
        </view>
      </view>
    </block>

    <!-- 滚动锚点 -->
    <view id="scrollBottom" style="height: 10rpx;"></view>
  </scroll-view>
</view>
